!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t(require("vue")):"function"==typeof define&&define.amd?define(["vue"],t):"object"==typeof exports?exports.XUI=t(require("vue")):e.XUI=t(e.vue)}(self,(function(e){return function(){"use strict";var t={580:function(e,t){t.Z=(e,t)=>{const l=e.__vccOpts||e;for(const[e,a]of t)l[e]=a;return l}},748:function(t){t.exports=e}},l={};function a(e){var o=l[e];if(void 0!==o)return o.exports;var n=l[e]={exports:{}};return t[e](n,n.exports,a),n.exports}a.d=function(e,t){for(var l in t)a.o(t,l)&&!a.o(e,l)&&Object.defineProperty(e,l,{enumerable:!0,get:t[l]})},a.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},a.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})};var o={};return function(){a.r(o),a.d(o,{TimeSelection:function(){return w},default:function(){return S}});var e=a(748);const t={class:"x-calendar",ref:"calendarRef"},l={class:"x-schedule",ref:"scheduleRef"},n={class:"x-calendar-table"},r={class:"x-calendar-head"},s=(0,e.createElementVNode)("tr",null,[(0,e.createElementVNode)("th",{rowspan:"8",class:"week-td"},"星期/时间"),(0,e.createElementVNode)("th",{colspan:"24"},"00:00 - 12:00"),(0,e.createElementVNode)("th",{colspan:"24"},"12:00 - 24:00")],-1),c=["textContent"],i={class:"x-calendar-body"},d=["textContent"],u=["data-week","data-time","onMousedown"],m={colspan:"49"},p={class:"pull-left"},f={key:0,class:"td-selected-time"},v={class:"item-text"},h={class:"x-calendar-popover"},y={ref:"popoverRef",class:"x-calendar-popover-wrapper"},x=(0,e.createElementVNode)("div",{class:"x-calendar-popover-arrow"},null,-1),g={class:"x-calendar-popover-panel"},E=["textContent"],k=(e,t)=>{let l=e.className,a=""!=l?" ":"";e.className=`${l}${a}${t}`},N=(e,t)=>{let l=" "+e.className+" ";l=l.replace(/(\s+)/gi," ");let a=l.replace(" "+t+" "," ");a=a.replace(/(^\s+)|(\s+$)/g,""),e.className=a};var V=(0,e.defineComponent)({name:"XTimeSelection",props:{modelValue:{type:String,default:""}},emits:["update:modelValue"],setup(t,l){const a=Array.from({length:24},((e,t)=>t)),o=Array.from({length:48},((e,t)=>t)),n=["一","二","三","四","五","六","日"].map((e=>`星期${e}`)),r={...n};let s="",c=null,i={x:"",y:""},d=0,u=!1,m=null,p=!1;const f=(0,e.reactive)({hoverWeek:"",hoverTime:"",isPopover:!1,selectedTimeList:[]}),v=e=>{let t=[];return JSON.parse(JSON.stringify(e)).forEach(((e,l)=>{let a=(e=e.sort(((e,t)=>e-t))).reduce(((e,t)=>(e.length&&t-e[0][0]==1?e[0].unshift(t):e.unshift([t]),e)),[]).reverse().map((e=>e.reverse())),o=[];a.forEach((e=>{o.push(e[0]/2+"-"+(e[e.length-1]+1)/2)})),t[l]=o.join(",")})),V(t),"||||||"===t.join("|")?"":t.join("|")},h=(e,t)=>{let l=e.getBoundingClientRect();return{x:l.left+(t?l.width:0),y:l.top+(t?l.height:0)}},y=()=>{i&&(i=null,c=m,N(w.value,"no-transition"),x(s,c))},x=(e,t)=>{if(e&&t){let l=w.value,a=parseInt(e.getAttribute("data-week")),o=parseInt(e.getAttribute("data-time")),n=parseInt(t.getAttribute("data-week")),r=parseInt(t.getAttribute("data-time")),s=Math.min(a,n),c=Math.max(a,n),i=Math.min(o,r),d=Math.max(o,r);l.style.opacity=0,setTimeout((()=>{l.style.display="none"}),500),g(i,s,d,c)}},g=(e,t,a,o)=>{b.value.querySelectorAll(".calendar-atom-time").forEach((l=>{let n=parseInt(l.getAttribute("data-time")),r=parseInt(l.getAttribute("data-week")),s=M.value[r].indexOf(n);n>=e&&n<=a&&r>=t&&r<=o&&(void 0===M.value[r]&&(M.value[r]=[],M.value[r].push(n)),M.value[r]&&(p?-1===s&&(M.value[r].push(n),k(l,"ui-selected")):s>-1&&(M.value[r].splice(s,1),N(l,"ui-selected"))))})),l.emit("update:modelValue",v(M.value))},E=()=>{b.value.querySelectorAll(".calendar-atom-time").forEach((e=>{N(e,"ui-selected")})),M.value.forEach(((e,t)=>{let l=b.value.querySelectorAll("tr")[t+2];e.forEach((e=>{l.querySelectorAll("td")[e+1].className="calendar-atom-time ui-selected"}))}))},V=e=>{f.selectedTimeList=[],e.forEach(((e,t)=>{if(e){let l={week:"",time:""};l.week=r[t];let a=[];e.split(",").forEach((e=>{let t=e.split("-"),l=n(t[0]),o=n(t[1]);function n(e){return e.indexOf(".")>-1?`${parseInt(e.padStart(2,"0"))}:30`:`${e.padStart(2,"0")}:00`}a.push(l+"~"+o)})),l.time=a.join(","),f.selectedTimeList.push(l)}}))},b=(0,e.ref)(),w=(0,e.ref)(),S=(0,e.ref)();let M=(0,e.computed)({get:()=>(e=>{let t=[],l=(e||"||||||").split("|");return V(l),l.forEach(((e,l)=>{t[l]=[],e.split(",").forEach((e=>{let a=e.split("-");for(let e=2*a[0];e<2*a[1];e++)t[l].push(e)}))})),t})(t.modelValue),set:e=>{l.emit("update:modelValue",v(e))}});return(0,e.watch)((()=>M.value),(()=>{E()})),(0,e.onMounted)((()=>{E();let e=b.value;e.addEventListener("mousedown",(e=>{if("calendar-atom-time",e.target.className.split(/\s+/).includes("calendar-atom-time")&&1===e.which&&(s=e.target)){i=h(e.target,!1);let t=w.value;t.style.width=0,t.style.height=0,t.style.left=`${i.x}px`,t.style.top=`${i.y}px`,t.style.opacity=.6,t.style.display="block",k(t,"no-transition")}})),e.addEventListener("mousemove",(e=>{m=document.elementFromPoint(e.clientX,e.clientY);let t=h(m,!0);if(i){let e=t.x-i.x,l=t.y-i.y,a=l>0?i.y:t.y-20,o=e>0?i.x:t.x-10,n=e>0?Math.abs(e):Math.abs(e)+22,r=l>0?Math.abs(l):Math.abs(l)+42,s=w.value;s.style.width=`${n}px`,s.style.height=`${r}px`,s.style.top=`${a}px`,s.style.left=`${o}px`}})),e.addEventListener("mouseup",(()=>{y()})),e.addEventListener("mousewheel",(()=>{y()})),e.addEventListener("mouseleave",(()=>{y()}))})),{dayHour:a,dayHalfHour:o,weekName:n,...(0,e.toRefs)(f),calendarRef:b,scheduleRef:w,popoverRef:S,onMousedown:(e,t)=>{((e,t)=>{let l=M.value[e];p=!l||-1===l.indexOf(t)})(e,t)},onMouseenter:t=>{(t=>{let l=t.target,a=l.getAttribute("data-week"),o=l.getAttribute("data-time");u=!0;let n=Math.floor(o/2).toString().padStart(2,"0"),s=o%2?`${n}:30 - ${(+n+1).toString().padStart(2,"0")}:00`:`${n}:00 - ${n}:30`;d&&clearTimeout(d),d=setTimeout((()=>{f.hoverWeek=r[a],f.hoverTime=s,f.isPopover=!!u,clearTimeout(d),(0,e.nextTick)().then((()=>{(e=>{let t=h(e,!0),l=S.value,a=h(l.parentNode,!0);l.style.transform=`translate3d(${t.x-a.x-l.offsetWidth/2-e.offsetWidth/2}px, ${t.y-a.y-l.offsetHeight-e.offsetHeight}px, 0px)`})(l)}))}),500)})(t)},onMouseleave:e=>{u=!1,f.hoverWeek="",f.hoverTime="",f.isPopover=!1},onResetAllClick:()=>{M.value=[[],[],[],[],[],[],[]],b.value.querySelectorAll(".calendar-atom-time").forEach((e=>{N(e,"ui-selected")}))}}}}),b=(0,a(580).Z)(V,[["render",function(a,o,k,N,V,b){return(0,e.openBlock)(),(0,e.createElementBlock)("div",t,[(0,e.createCommentVNode)(" 框选范围框 "),(0,e.createElementVNode)("div",l,null,512),(0,e.createCommentVNode)(" 表格显示区 "),(0,e.createElementVNode)("table",n,[(0,e.createElementVNode)("thead",r,[s,(0,e.createElementVNode)("tr",null,[((0,e.openBlock)(!0),(0,e.createElementBlock)(e.Fragment,null,(0,e.renderList)(a.dayHour,((t,l)=>((0,e.openBlock)(),(0,e.createElementBlock)("td",{key:l,colspan:"2",textContent:(0,e.toDisplayString)(t)},null,8,c)))),128))])]),(0,e.createElementVNode)("tbody",i,[((0,e.openBlock)(!0),(0,e.createElementBlock)(e.Fragment,null,(0,e.renderList)(a.weekName,((t,l)=>((0,e.openBlock)(),(0,e.createElementBlock)("tr",{key:l},[(0,e.createElementVNode)("td",{textContent:(0,e.toDisplayString)(t)},null,8,d),((0,e.openBlock)(!0),(0,e.createElementBlock)(e.Fragment,null,(0,e.renderList)(a.dayHalfHour,((t,n)=>((0,e.openBlock)(),(0,e.createElementBlock)("td",{key:n,"data-week":l,"data-time":t,class:"calendar-atom-time",onMousedown:()=>a.onMousedown(l,t),onMouseenter:o[0]||(o[0]=(...e)=>a.onMouseenter&&a.onMouseenter(...e)),onMouseleave:o[1]||(o[1]=(...e)=>a.onMouseleave&&a.onMouseleave(...e))},null,40,u)))),128))])))),128)),(0,e.createElementVNode)("tr",null,[(0,e.createElementVNode)("td",m,[(0,e.createElementVNode)("div",null,[(0,e.createElementVNode)("span",p,(0,e.toDisplayString)(a.selectedTimeList.length?"已选择时间段":"可拖动鼠标选择时间"),1),(0,e.createElementVNode)("a",{class:"pull-right",onClick:o[2]||(o[2]=(...e)=>a.onResetAllClick&&a.onResetAllClick(...e))},"清空选择")]),a.selectedTimeList.length?((0,e.openBlock)(),(0,e.createElementBlock)("div",f,[((0,e.openBlock)(!0),(0,e.createElementBlock)(e.Fragment,null,(0,e.renderList)(a.selectedTimeList,((t,l)=>((0,e.openBlock)(),(0,e.createElementBlock)("p",{key:l},[(0,e.createElementVNode)("span",null,(0,e.toDisplayString)(t.week)+"：",1),(0,e.createElementVNode)("span",v,(0,e.toDisplayString)(t.time),1)])))),128))])):(0,e.createCommentVNode)("v-if",!0)])])]),(0,e.createCommentVNode)(" 悬浮提示 "),(0,e.createElementVNode)("div",h,[(0,e.withDirectives)((0,e.createElementVNode)("div",y,[x,(0,e.createElementVNode)("div",g,[(0,e.createElementVNode)("div",{class:"x-calendar-popover-body",textContent:(0,e.toDisplayString)(`${a.hoverWeek} ${a.hoverTime}`)},null,8,E)])],512),[[e.vShow,a.isPopover]])])])],512)}]]);b.install=e=>{e.component(b.name,b)};const w=b;var S=b}(),o}()}));
//# sourceMappingURL=timeSelection.js.map